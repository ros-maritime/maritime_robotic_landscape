<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 600" width="1000" height="600">
  <!-- Title -->
  <text x="500" y="30" font-size="22" font-weight="bold" text-anchor="middle" fill="#1e88e5">
    Thrust Allocation Architecture: Wrench to Thrusters
  </text>

  <!-- Input: Desired Wrench -->
  <g id="input">
    <rect x="50" y="80" width="180" height="120" rx="8" fill="#43a047" stroke="#2e7d32" stroke-width="3"/>
    <text x="140" y="110" font-size="15" font-weight="bold" text-anchor="middle" fill="white">Desired Wrench</text>
    <text x="140" y="130" font-size="11" text-anchor="middle" fill="#c8e6c9">From PID Controllers</text>
    <line x1="60" y1="140" x2="220" y2="140" stroke="white" stroke-width="1"/>
    <text x="70" y="155" font-size="10" fill="white">Forces (N):</text>
    <text x="80" y="170" font-size="9" fill="#c8e6c9">F_x = 50</text>
    <text x="80" y="183" font-size="9" fill="#c8e6c9">F_y = 10</text>
    <text x="80" y="196" font-size="9" fill="#c8e6c9">F_z = -20</text>

    <text x="150" y="155" font-size="10" fill="white">Torques (N·m):</text>
    <text x="160" y="170" font-size="9" fill="#c8e6c9">τ_x = 5</text>
    <text x="160" y="183" font-size="9" fill="#c8e6c9">τ_y = 0</text>
    <text x="160" y="196" font-size="9" fill="#c8e6c9">τ_z = 8</text>
  </g>

  <!-- Thrust Allocation Matrix (TAM) -->
  <g id="tam">
    <rect x="280" y="80" width="200" height="120" rx="8" fill="#1e88e5" stroke="#0d47a1" stroke-width="3"/>
    <text x="380" y="110" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Allocation Matrix</text>
    <text x="380" y="128" font-size="10" text-anchor="middle" fill="#bbdefb">T (6×n)</text>

    <line x1="290" y1="138" x2="470" y2="138" stroke="white" stroke-width="1"/>

    <text x="295" y="153" font-size="9" fill="white">Each column = one thruster:</text>
    <text x="300" y="168" font-size="8" fill="#bbdefb">[force_x, force_y, force_z,</text>
    <text x="300" y="181" font-size="8" fill="#bbdefb"> torque_x, torque_y, torque_z]ᵀ</text>
    <text x="300" y="194" font-size="8" fill="#e3f2fd">at unit thrust (1N)</text>

    <!-- Arrow from wrench -->
    <line x1="230" y1="140" x2="280" y2="140" stroke="#43a047" stroke-width="3" marker-end="url(#arrowGreen)"/>
    <text x="245" y="130" font-size="10" fill="#43a047">τ</text>
  </g>

  <!-- Allocation Method Choice -->
  <g id="method-choice">
    <rect x="520" y="50" width="220" height="180" rx="8" fill="#ff6f00" opacity="0.1" stroke="#ff6f00" stroke-width="2"/>
    <text x="630" y="75" font-size="13" font-weight="bold" text-anchor="middle" fill="#ff6f00">Allocation Method</text>

    <!-- Pseudo-Inverse -->
    <rect x="535" y="85" width="190" height="55" rx="5" fill="#fff3e0" stroke="#ff6f00" stroke-width="2"/>
    <text x="630" y="105" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">Pseudo-Inverse</text>
    <text x="630" y="120" font-size="9" text-anchor="middle" fill="#666">u = T⁺ · τ</text>
    <text x="630" y="132" font-size="8" text-anchor="middle" fill="#666">Fast (1ms), no saturation</text>

    <!-- QP-based -->
    <rect x="535" y="150" width="190" height="70" rx="5" fill="#e3f2fd" stroke="#1e88e5" stroke-width="2"/>
    <text x="630" y="170" font-size="12" font-weight="bold" text-anchor="middle" fill="#0d47a1">QP-based (MVP)</text>
    <text x="630" y="185" font-size="9" text-anchor="middle" fill="#666">min ||T·u - τ||²</text>
    <text x="630" y="197" font-size="9" text-anchor="middle" fill="#666">s.t. u_min ≤ u ≤ u_max</text>
    <text x="630" y="211" font-size="8" text-anchor="middle" fill="#666">Slower (5-20ms), optimal</text>

    <!-- Arrow from TAM -->
    <line x1="480" y1="140" x2="520" y2="140" stroke="#1e88e5" stroke-width="3"/>
  </g>

  <!-- Saturation Block (for pseudo-inverse) -->
  <g id="saturation">
    <rect x="770" y="70" width="180" height="80" rx="5" fill="#f44336" opacity="0.15" stroke="#f44336" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="860" y="95" font-size="12" font-weight="bold" text-anchor="middle" fill="#c62828">Saturation</text>
    <text x="860" y="112" font-size="10" text-anchor="middle" fill="#666">(Pseudo-inverse only)</text>
    <text x="860" y="127" font-size="9" text-anchor="middle" fill="#666">clamp(u, u_min, u_max)</text>
    <text x="860" y="141" font-size="8" text-anchor="middle" fill="#f44336">⚠ Degrades performance</text>

    <!-- Arrow from pseudo-inverse -->
    <path d="M 725 112 L 770 100" stroke="#ff6f00" stroke-width="2" stroke-dasharray="3,2" marker-end="url(#arrowOrange)"/>
  </g>

  <!-- Thruster Commands Output -->
  <g id="output">
    <rect x="770" y="280" width="180" height="140" rx="8" fill="#9c27b0" stroke="#4a148c" stroke-width="3"/>
    <text x="860" y="310" font-size="15" font-weight="bold" text-anchor="middle" fill="white">Thruster Commands</text>
    <text x="860" y="328" font-size="11" text-anchor="middle" fill="#e1bee7">u = [u₁, u₂, ..., uₙ]ᵀ</text>

    <line x1="780" y1="338" x2="940" y2="338" stroke="white" stroke-width="1"/>

    <text x="790" y="355" font-size="10" fill="white">Example (6 thrusters):</text>
    <text x="795" y="372" font-size="9" fill="#e1bee7">u₁ = 12.3 N</text>
    <text x="795" y="385" font-size="9" fill="#e1bee7">u₂ = -8.5 N</text>
    <text x="795" y="398" font-size="9" fill="#e1bee7">u₃ = 15.0 N (saturated)</text>
    <text x="795" y="411" font-size="9" fill="#e1bee7">...</text>

    <!-- Arrows from methods -->
    <path d="M 630 140 L 630 240 L 860 240 L 860 280" stroke="#1e88e5" stroke-width="3" marker-end="url(#arrowBlue)"/>
    <text x="700" y="220" font-size="10" fill="#1e88e5">QP solution</text>

    <path d="M 860 150 L 860 280" stroke="#ff6f00" stroke-width="2" stroke-dasharray="3,2" marker-end="url(#arrowOrange)"/>
    <text x="870" y="220" font-size="10" fill="#ff6f00">Pseudo-inv</text>
  </g>

  <!-- Physical Thrusters -->
  <g id="thrusters">
    <text x="50" y="300" font-size="15" font-weight="bold" fill="#666">Physical Thrusters:</text>

    <!-- Thruster 1 -->
    <rect x="50" y="320" width="100" height="90" rx="5" fill="#424242" stroke="#212121" stroke-width="2"/>
    <text x="100" y="343" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Thruster 1</text>
    <text x="100" y="360" font-size="9" text-anchor="middle" fill="#bdbdbd">Position: [0.3, 0.2, 0]</text>
    <text x="100" y="373" font-size="9" text-anchor="middle" fill="#bdbdbd">Direction: [1, 0, 0]</text>
    <text x="100" y="386" font-size="9" text-anchor="middle" fill="#ffd54f">Max: ±16N (T500)</text>
    <text x="100" y="402" font-size="10" text-anchor="middle" fill="#4caf50">Command: 12.3N</text>

    <!-- Thruster 2-6 (simplified) -->
    <rect x="170" y="320" width="100" height="90" rx="5" fill="#424242" stroke="#212121" stroke-width="2"/>
    <text x="220" y="343" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Thruster 2</text>
    <text x="220" y="365" font-size="9" text-anchor="middle" fill="#bdbdbd">...</text>
    <text x="220" y="402" font-size="10" text-anchor="middle" fill="#4caf50">Command: -8.5N</text>

    <text x="290" y="365" font-size="11" fill="#666">... (Thrusters 3-6)</text>

    <!-- Arrows to thrusters -->
    <path d="M 770 350 L 280 365" stroke="#9c27b0" stroke-width="2" marker-end="url(#arrowPurple)"/>
  </g>

  <!-- Vehicle Diagram (showing thruster placement) -->
  <g id="vehicle-diagram">
    <rect x="350" y="300" width="370" height="200" rx="8" fill="#f5f5f5" stroke="#666" stroke-width="2"/>
    <text x="535" y="325" font-size="13" font-weight="bold" text-anchor="middle" fill="#333">6-DOF Thruster Configuration</text>

    <!-- Top view of vehicle -->
    <ellipse cx="535" cy="410" rx="100" ry="40" fill="#1e88e5" opacity="0.3" stroke="#0d47a1" stroke-width="2"/>
    <text x="535" y="415" font-size="11" text-anchor="middle" fill="#0d47a1">AUV (top view)</text>

    <!-- Horizontal thrusters (4x) -->
    <rect x="420" y="395" width="15" height="8" rx="1" fill="#ff6f00"/>
    <text x="412" y="402" font-size="8" fill="#666">T1</text>
    <line x1="420" y1="399" x2="400" y2="399" stroke="#ff6f00" stroke-width="1.5" marker-end="url(#arrowOrangeSmall)"/>

    <rect x="635" y="395" width="15" height="8" rx="1" fill="#ff6f00"/>
    <text x="658" y="402" font-size="8" fill="#666">T2</text>
    <line x1="650" y1="399" x2="670" y2="399" stroke="#ff6f00" stroke-width="1.5" marker-end="url(#arrowOrangeSmall)"/>

    <rect x="420" y="420" width="15" height="8" rx="1" fill="#ff6f00"/>
    <text x="412" y="427" font-size="8" fill="#666">T3</text>

    <rect x="635" y="420" width="15" height="8" rx="1" fill="#ff6f00"/>
    <text x="658" y="427" font-size="8" fill="#666">T4</text>

    <!-- Vertical thrusters (2x) -->
    <circle cx="505" cy="390" r="6" fill="#43a047"/>
    <text x="505" y="382" font-size="8" text-anchor="middle" fill="#666">T5↓</text>

    <circle cx="565" cy="390" r="6" fill="#43a047"/>
    <text x="565" y="382" font-size="8" text-anchor="middle" fill="#666">T6↓</text>

    <!-- Coordinate system -->
    <line x1="535" y1="455" x2="575" y2="455" stroke="#f44336" stroke-width="2" marker-end="url(#arrowRed)"/>
    <text x="580" y="460" font-size="10" fill="#f44336">X (fwd)</text>

    <line x1="535" y1="455" x2="535" y2="485" stroke="#43a047" stroke-width="2" marker-end="url(#arrowGreenSmall)"/>
    <text x="540" y="495" font-size="10" fill="#43a047">Y (port)</text>
  </g>

  <!-- Performance Comparison -->
  <g id="comparison">
    <rect x="50" y="530" width="900" height="60" rx="5" fill="#fff9c4" stroke="#f57c00" stroke-width="2"/>
    <text x="500" y="553" font-size="13" font-weight="bold" text-anchor="middle" fill="#f57c00">Method Selection Guide</text>

    <text x="70" y="572" font-size="10" fill="#666"><tspan font-weight="bold">Pseudo-Inverse:</tspan> Use when square TAM (n=6), all forces/torques achievable, real-time critical (&lt;1ms)</text>
    <text x="70" y="586" font-size="10" fill="#666"><tspan font-weight="bold">QP-based:</tspan> Use when non-square TAM, saturation inevitable, optimal allocation needed (5-20ms acceptable)</text>
  </g>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#43a047"/>
    </marker>
    <marker id="arrowGreenSmall" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6" fill="#43a047"/>
    </marker>
    <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#1e88e5"/>
    </marker>
    <marker id="arrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#ff6f00"/>
    </marker>
    <marker id="arrowOrangeSmall" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6" fill="#ff6f00"/>
    </marker>
    <marker id="arrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#9c27b0"/>
    </marker>
    <marker id="arrowRed" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#f44336"/>
    </marker>
  </defs>
</svg>
